@using Microsoft.AspNetCore.Builder
@using Microsoft.AspNetCore.Localization
@using Microsoft.AspNetCore.Mvc.Localization
@using Microsoft.Extensions.Options

@inject IViewLocalizer Localizer
@inject IOptions<RequestLocalizationOptions> LocOptions

@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var cultureItems = LocOptions.Value.SupportedUICultures
        .Select(c => new SelectListItem { Value = c.Name, Text = Localizer.GetString(c.NativeName) })
        .ToList();
    var returnUrl = string.IsNullOrEmpty(Context.Request.Path) ? "~/" : $"~{Context.Request.Path.Value}{Context.Request.QueryString}";
}


<div title="@Localizer["Request culture provider:"] @requestCulture?.Provider?.GetType().Name" style="padding: 10px;">
    <a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        <span class="mr-2 d-lg-inline text-gray-600 small">
            @if (requestCulture != null)
            {
                @if (requestCulture.RequestCulture.UICulture.Name == "en")
                {
                    <i class="flag-icon flag-icon-gb"></i>
                }
                else if (requestCulture.RequestCulture.UICulture.Name == "pt")
                {
                    <i class="flag-icon flag-icon-pt"></i>
                }
                else if (requestCulture.RequestCulture.UICulture.Name == "es")
                {
                    <i class="flag-icon flag-icon-es"></i>
                }
                <span>&nbsp;</span>
                @requestCulture.RequestCulture.UICulture.NativeName.ToLower()
            }
        </span>
    </a>
    <ul class="dropdown-menu">
        @foreach (var culture in cultureItems)
        {
            <li>
                <form style="padding:0px!important"
                  asp-area="Settings"
                  asp-controller="Culture"
                  asp-action="SetCulture"
                  asp-route-returnUrl="@returnUrl"
                  asp-route-culture="@culture.Value"
                      method="post"
                      class="form-horizontal"
                      role="form">
                    <button type="submit" class="dropdown-item">
                        @if (culture.Value == "en" || culture.Value == "en-US")
                        {
                            <i class="flag-icon flag-icon-gb"></i>
                        }
                        else if (culture.Value == "pt")
                        {
                            <i class="flag-icon flag-icon-pt"></i>
                        }
                        else if (culture.Value == "es")
                        {
                            <i class="flag-icon flag-icon-es"></i>
                        }
                        <span>&nbsp;</span>
                        @culture.Text.ToLower()
                    </button>
                </form>
            </li>
        }
    </ul>
</div>
