@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer localizer
@using Core.Constants
@using LVLgroupApp.Areas.Dashboard.Models.DashboardVendasGeral
@model ChartSemanalViewModel



<link href="~/css/dashboard.css" rel="stylesheet">




<div class="row pt-lg-5">
    <div class="col-lg-12 col-12">
        <!--Div that will hold the bars chart-->
        <div id="chart_vendas_semana_div"></div>
    </div>
</div>


<script type="text/javascript">
    
    var data;
    var chart;

    // Load the Visualization API and the piechart package.
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.load('current', { 'packages': ['bar'] });

    // Set a callback to run when the Google Visualization API is loaded.
    // google.charts.setOnLoadCallback(drawDonutChart);
    google.charts.setOnLoadCallback(drawAreaChart);


    // Callback that creates and populates a data table,
    // instantiates the bars chart, passes in the data and
    // draws it.
    function drawAreaChart() {

        // Create our data table.
        dataArea = new google.visualization.DataTable();

        // Add columns
        var columns = @Html.Raw(Json.Serialize(Model.VendasSemanaisColumnsList))
        console.log(columns);
        for (var i = 0; i < columns.length; i++) {
            //add uma coluna por cada ano + obj
            dataArea.addColumn(columns[i].columnType, columns[i].columnName);
        }

        // Add rows
        var rows = @Html.Raw(Json.Serialize(Model.VendasSemanaisRowsList))
        console.log(rows);
        for (var i = 0; i < rows.length; i++) {
            // add uma row por cada semana (53)
            const newFirstElement = rows[i].label;

            // Substituir zeros por null na valuesList
            const cleanedValues = rows[i].valuesList.map(function (val) {
                return val === 0 ? null : val;
            });
            const dataRow = [newFirstElement].concat(cleanedValues);
            //const dataRow = [newFirstElement].concat(rows[i].valuesList);

            dataArea.addRow(dataRow);
        }

        var optionsArea = {
            'title': @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Title)),
            'subtitle': @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Subtitle)),
            'height': '800',
            // 'explorer': {
            //     'axis': 'horizontal'
            // },
            'legend': { 
                'position': 'bottom'
            },
            'colors': ['red', '#1763AD', 'purple'],
            'seriesType': 'area',
            'series': {
                2: {type: 'line'}
            }
        };

        // Instantiate and draw bar chart, passing in some options.
        chart_area = new google.visualization.ComboChart(document.getElementById('chart_vendas_semana_div'));
        google.visualization.events.addListener(chart_area, 'select', selectHandler);
        chart_area.draw(dataArea, google.charts.Bar.convertOptions(optionsArea));
    }

    function selectHandler() {
        //var selectedItem = chart_total.getSelection()[0];
        //var value = data.getValue(selectedItem.row, 0);
        //alert('The user selected ' + value);
    }

</script>
